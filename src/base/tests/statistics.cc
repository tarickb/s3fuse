#include <gtest/gtest.h>
#include <memory>
#include <sstream>

#include "base/statistics.h"

namespace s3 {
namespace base {
namespace tests {

TEST(Statistics, Write100) {
  std::unique_ptr<std::ostringstream> out(new std::ostringstream());
  auto *out_ptr = out.get();

  Statistics::Init(std::move(out));
  for (int i = 0; i < 10; i++) {
    for (int j = 0; j < 10; j++)
      Statistics::Write("object", std::to_string(i), "%i", j);
  }
  Statistics::Flush();

  std::string exp =
      "object_0: 0\n"
      "object_0: 1\n"
      "object_0: 2\n"
      "object_0: 3\n"
      "object_0: 4\n"
      "object_0: 5\n"
      "object_0: 6\n"
      "object_0: 7\n"
      "object_0: 8\n"
      "object_0: 9\n"
      "object_1: 0\n"
      "object_1: 1\n"
      "object_1: 2\n"
      "object_1: 3\n"
      "object_1: 4\n"
      "object_1: 5\n"
      "object_1: 6\n"
      "object_1: 7\n"
      "object_1: 8\n"
      "object_1: 9\n"
      "object_2: 0\n"
      "object_2: 1\n"
      "object_2: 2\n"
      "object_2: 3\n"
      "object_2: 4\n"
      "object_2: 5\n"
      "object_2: 6\n"
      "object_2: 7\n"
      "object_2: 8\n"
      "object_2: 9\n"
      "object_3: 0\n"
      "object_3: 1\n"
      "object_3: 2\n"
      "object_3: 3\n"
      "object_3: 4\n"
      "object_3: 5\n"
      "object_3: 6\n"
      "object_3: 7\n"
      "object_3: 8\n"
      "object_3: 9\n"
      "object_4: 0\n"
      "object_4: 1\n"
      "object_4: 2\n"
      "object_4: 3\n"
      "object_4: 4\n"
      "object_4: 5\n"
      "object_4: 6\n"
      "object_4: 7\n"
      "object_4: 8\n"
      "object_4: 9\n"
      "object_5: 0\n"
      "object_5: 1\n"
      "object_5: 2\n"
      "object_5: 3\n"
      "object_5: 4\n"
      "object_5: 5\n"
      "object_5: 6\n"
      "object_5: 7\n"
      "object_5: 8\n"
      "object_5: 9\n"
      "object_6: 0\n"
      "object_6: 1\n"
      "object_6: 2\n"
      "object_6: 3\n"
      "object_6: 4\n"
      "object_6: 5\n"
      "object_6: 6\n"
      "object_6: 7\n"
      "object_6: 8\n"
      "object_6: 9\n"
      "object_7: 0\n"
      "object_7: 1\n"
      "object_7: 2\n"
      "object_7: 3\n"
      "object_7: 4\n"
      "object_7: 5\n"
      "object_7: 6\n"
      "object_7: 7\n"
      "object_7: 8\n"
      "object_7: 9\n"
      "object_8: 0\n"
      "object_8: 1\n"
      "object_8: 2\n"
      "object_8: 3\n"
      "object_8: 4\n"
      "object_8: 5\n"
      "object_8: 6\n"
      "object_8: 7\n"
      "object_8: 8\n"
      "object_8: 9\n"
      "object_9: 0\n"
      "object_9: 1\n"
      "object_9: 2\n"
      "object_9: 3\n"
      "object_9: 4\n"
      "object_9: 5\n"
      "object_9: 6\n"
      "object_9: 7\n"
      "object_9: 8\n"
      "object_9: 9\n";

  EXPECT_EQ(exp, out_ptr->str());
}

}  // namespace tests
}  // namespace base
}  // namespace s3
